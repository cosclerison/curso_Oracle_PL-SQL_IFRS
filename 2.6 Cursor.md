## 2.6 Cursor

Quando o Oracle executa uma consulta ele utilizada uma área da Memória para colocar o resultado desta consulta. Para recuperar cada uma das linhas do resultado utilizamos cursores. Existem dois tipos de cursores, implícitos e explícitos. Para qualquer comando DML (e SELECT que retorna uma única linha) o Oracle implicitamente abre um cursor chamado SQL. A cláusula INTO pode ser usado no SELECT apenas nas consultas que retornam uma única linha, nas consultas que retornam uma linha ou mais devemos utilizar cursores explícitos. Os cursores podem ser utilizados em qualquer tipo de bloco PL/SQL (anônimo, procedure, function e trigger).



Declaração de cursor explícito
CURSOR cursor_name [(parameter[, parameter]...)]
[RETURN return_type] IS select_statement;

Exemplo: Recuperar o código, nome e salário de todos os funcionários da empresa. Neste caso não podemos utilizar o INTO pois o SELECT pode retornar mais de uma linha.

CURSOR c_funcinario IS
SELECT id_funcionario, nome_funcionario, salario 
FROM funcionario;



Operações associadas a cursores

Open: Executa a consulta associada ao cursor e armazena o resultado na memória cujo início é apontado pelo cursor.

open <nome-cursor>

Fetch: Recupera uma linha do resultado. Transfere os seus valores para as variáveis e avança o cursor para a próxima linha.

Sintaxe:

fetch <nome-cursor> into <variáveis>

Close: Desativa o cursor e libera os dados da área temporária de memória.



Atributos do cursor
%ISOPEN     - Retorna verdadeiro se o cursor estiver aberto
%NOTFOUND   - Retorna verdadeiro se o FETCH mais recente não retornou nenhuma linha
%FOUND      - Retorna verdadeiro se o FETCH mais recente retornou uma linha
%ROWCOUNT   - Retorna o número total de linhas recuperadas até o momento